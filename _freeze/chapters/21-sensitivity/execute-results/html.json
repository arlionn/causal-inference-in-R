{
  "hash": "4d7bb6bfd4714efa1e7b6dbdb7bd124b",
  "result": {
    "markdown": "# Sensitivity analysis {#sec-sensitivity}\n\n\n\n\n\n\n\nBecause many of the assumptions of causal inference are unverifiable, it's reasonable to be concerned about the validity of your results.\nIn this chapter, we'll provide some ways to probe our assumptions and results for strengths and weaknesses.\nWe'll explore two main ways to do so: exploring the logical implications of the causal question and related DAGs and using mathematical techniques to quantify how different our results would be under other circumstances, such as in the presence of unmeasured confounding.\nThese approaches are known as *sensitivity analyses*: How sensitive is our result to conditions other than those laid out in our assumptions and analysis?\n\n## Checking DAGs for robustness\n\nLet's start with where we began the modeling process: creating causal diagrams.\nBecause DAGs encode the assumptions on which we base our analysis, they are natural points of critique for both others and ourselves.\n\n### Alternate adjustment sets and alternate DAGs\n\nThe same mathematical underpinnings of DAGs that allow us to to query them for things like adjustment sets also allow us to query other implications of DAGs.\nOne of the simplest is that if your DAG is correct and your data are well-measured, any valid adjustment set should result in an unbiased estimate of the causal effect.\nLet's consider the DAG we introduced in @fig-dag-magic.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![The original proposed DAG for the relationship between Extra Magic Hours in the morning at a particular park and the average wait time between 9 am and 10 am. As before, we are saying that we believe 1) Extra Magic Hours impacts average wait time and 2) both Extra Magic Hours and average wait time are determined by the time the park closes, historic high temperatures, and ticket season.](21-sensitivity_files/figure-html/fig-dag-magic-orig-1.png){#fig-dag-magic-orig width=672}\n:::\n:::\n\n\nIn @fig-dag-magic-orig, there's only one adjustment set because all three confounders represent independent backdoor paths.\nLet's say, though, that we had used @fig-dag-magic-missing instead, which is missing arrows from the park close time and historical temperature to whether there was an Extra Magic Morning.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![An alternative DAG for the relationship between Extra Magic Hours in the morning at a particular park and the average wait time between 9 am and 10 am. This DAG has no arrows from park close time and historical temperature to Extra Magic Hours.](21-sensitivity_files/figure-html/fig-dag-magic-missing-1.png){#fig-dag-magic-missing width=672}\n:::\n:::\n\n\nNow there are 4 potential adjustment sets: `park_ticket_season, park_close + park_ticket_season`, `park_temperature_high + park_ticket_season`, or `park_close + park_temperature_high + park_ticket_season`.\n@tbl-alt-sets presents the IPW estimates for each adjustment set.\nThe effects are quite different.\nSome slight variation in the estimates is expected since they are estimated using different variables that may not be measured perfectly; if this DAG were right, however, we should see them much more closely aligned than this.\nIn particular, there seems to be a 3-minute difference between the models with and without park close time.\nThe difference in these results implies that there is something off about the causal structure we specified.\n\n\n::: {#tbl-alt-sets .cell tbl-cap='A table of ATE estimates from the IPW estimator. Each estimate was calculated for one of the valid adjustment sets for the DAG. The estimates are sorted by effect size in order. If the DAG is right and all the data well measured, different adjustment sets should give roughly the same answer.'}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"fkzitoempa\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fkzitoempa table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fkzitoempa thead, #fkzitoempa tbody, #fkzitoempa tfoot, #fkzitoempa tr, #fkzitoempa td, #fkzitoempa th {\n  border-style: none;\n}\n\n#fkzitoempa p {\n  margin: 0;\n  padding: 0;\n}\n\n#fkzitoempa .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fkzitoempa .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fkzitoempa .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fkzitoempa .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fkzitoempa .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fkzitoempa .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fkzitoempa .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fkzitoempa .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fkzitoempa .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fkzitoempa .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fkzitoempa .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fkzitoempa .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fkzitoempa .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fkzitoempa .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fkzitoempa .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fkzitoempa .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fkzitoempa .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fkzitoempa .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fkzitoempa .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fkzitoempa .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fkzitoempa .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fkzitoempa .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fkzitoempa .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fkzitoempa .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fkzitoempa .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fkzitoempa .gt_left {\n  text-align: left;\n}\n\n#fkzitoempa .gt_center {\n  text-align: center;\n}\n\n#fkzitoempa .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fkzitoempa .gt_font_normal {\n  font-weight: normal;\n}\n\n#fkzitoempa .gt_font_bold {\n  font-weight: bold;\n}\n\n#fkzitoempa .gt_font_italic {\n  font-style: italic;\n}\n\n#fkzitoempa .gt_super {\n  font-size: 65%;\n}\n\n#fkzitoempa .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fkzitoempa .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fkzitoempa .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fkzitoempa .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fkzitoempa .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fkzitoempa .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fkzitoempa .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Adjustment Set\">Adjustment Set</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ATE\">ATE</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Adjustment Set\" class=\"gt_row gt_left\">Close time, ticket season</td>\n<td headers=\"ATE\" class=\"gt_row gt_right\">6.579</td></tr>\n    <tr><td headers=\"Adjustment Set\" class=\"gt_row gt_left\">Historic temperature, close time, ticket season</td>\n<td headers=\"ATE\" class=\"gt_row gt_right\">6.199</td></tr>\n    <tr><td headers=\"Adjustment Set\" class=\"gt_row gt_left\">Ticket season</td>\n<td headers=\"ATE\" class=\"gt_row gt_right\">4.114</td></tr>\n    <tr><td headers=\"Adjustment Set\" class=\"gt_row gt_left\">Historic temperature, ticket season</td>\n<td headers=\"ATE\" class=\"gt_row gt_right\">3.627</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n### Negative controls\n\nAlternate adjustment sets are a way of probing the logical implications of your DAG: if it's correct, there could be many ways to account for the open backdoor paths correctly.\nThe reverse is also true: the causal structure of your research question also implies relationships that should be *null*.\nOne way that researchers take advantage of this implication is through *negative controls*.\nA negative control is either an exposure (negative exposure control) or outcome (negative outcome control) similar to your question in as many ways as possible, except that there *shouldn't* be a causal effect.\n@Lipsitch2010 describe negative controls for observational research.\nIn their article, they reference standard controls in bench science. In a lab experiment, any of these actions should lead to a null effect:\n\n1.  Leave out an essential ingredient.\n2.  Inactivate the hypothesized active ingredient.\n3.  Check for an effect that would be impossible by the hypothesized outcome.\n\nThere's nothing unique to lab work here; these scientists merely probe the logical implications of their understanding and hypotheses. \nTo find a good negative control, you usually need to extend your DAG to include more of the causal structure surrounding your question.\nLet's look at some examples.\n\n#### Negative exposures\n\nFirst, we'll look at a negative exposure control.\nIf Extra Magic Mornings really cause an increase in wait time, it stands to reason that this effect is time-limited.\nIn other words, there should be some period after which the effect of Extra Magic Morning dissipates.\nLet's call today *i* and the previous day *i - n*, where *n* is the number of days before the outcome that the negative exposure control occurs.\nFirst, let's explore `n = 63`, e.g., whether or not there was an Extra Magic Morning nine weeks ago.\nThat is a pretty reasonable starting point: it's unlikely that the effect on wait time would still be present 63 days later.\nThis analysis is an example of leaving out an essential ingredient: we waited too long for this to be a realistic cause.\nAny remaining effect is likely due to residual confounding.\n\nLet's look at a DAG to visualize this situation.\nIn @fig-dag-day-i, we've added an identical layer to our original one: now there are two Extra Magic Mornings: one for day `i` and one for day `i - 63`.\nSimilarly, there are two versions of the confounders for each day.\nOne crucial detail in this DAG is that we're assuming that there *is* an effect of day `i - 63`'s Extra Magic Morning on day `i`'s; whether or not there is an Extra Magic Morning one day likely affects whether or not it happens on another day.\nThe decision about where to place them across the year is not random.\nIf this is true, we *would* expect an effect: the indirect effect via day `i`'s Extra Magic Morning status.\nTo get a valid negative control, we need to *inactivate this effect*, which we can do statistically by controlling for day `i`'s Extra Magic Morning status.\nSo, given the DAG, our adjustment set is any combination of the confounders (as long as we have at least one version of each) and day `i`'s Extra Magic Morning (suppressing the indirect effect).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![An expansion of the causal structure presented in @fig-dag-magic. In this DAG, the exposure is instead whether or not there were Extra Magic Hours 63 days before the day's wait time we are examining. Because of the long period, there should be no effect. Similarly, the DAG also has earlier confounders related to day `i - 63`.](21-sensitivity_files/figure-html/fig-dag-day-i-1.png){#fig-dag-day-i width=672}\n:::\n:::\n\n\nSince the exposure is on day `i - 63`, we prefer to control for the confounders related to that day, so we'll use the `i - 63` versions.\nWe'll use `lag()` from dplyr to get those variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_days_lag <- 63\ndistinct_emm <- seven_dwarfs_train_2018 |>\n  filter(wait_hour == 9) |>\n  arrange(park_date) |>\n  transmute(\n    park_date,\n    prev_park_extra_magic_morning = lag(park_extra_magic_morning, n = n_days_lag),\n    prev_park_temperature_high = lag(park_temperature_high, n = n_days_lag),\n    prev_park_close = lag(park_close, n = n_days_lag),\n    prev_park_ticket_season = lag(park_ticket_season, n = n_days_lag)\n  )\n\nseven_dwarfs_train_2018_lag <- seven_dwarfs_train_2018 |>\n  filter(wait_hour == 9) |>\n  left_join(distinct_emm, by = \"park_date\") |>\n  drop_na(prev_park_extra_magic_morning)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nWhen we use these data for the IPW effect, we get -0.93 minutes, much closer to null than we found on day `i`.\nLet's take a look at the effect over time.\nWhile there might be a lingering effect of Extra Magic Mornings for a little while (say, the span of an average trip to Disney World), it should quickly approach null.\nHowever, in @fig-sens-i-63, we see that, while it eventually approaches null, there is quite a bit of lingering effect.\nIf these results are accurate, it implies that we have some residual confounding in our effect.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![A scatterplot with a smoothed regression of the relationship between wait times on day `i` and whether there were Extra Magic Hours on day `i - n`, where `n` represents the number of days previous to day `i`. We expect this relationship to rapidly approach the null, but the effect hovers above null for quite some time. This lingering effect implies we have some residual confounding present.\n](21-sensitivity_files/figure-html/fig-sens-i-63-1.png){#fig-sens-i-63 width=672}\n:::\n:::\n\n\n#### Negative outcomes\n\nNow, let's examine an example of a negative control outcome: the wait time for a ride at Universal Studios.\nUniversal Studios is also in Orlando, so the set of causes for wait times are likely comparable to those at Disney World on the same day.\nOf course, whether or not there are Extra Magic Mornings at Disney shouldn't affect the wait times at Universal on the same day: they are separate parks, and most people don't visit both within an hour of one another.\nThis negative control is an example of an effect implausible by the hypothesized mechanism.\n\nWe don't have Universal's ride data, so let's simulate what would happen with and without residual confounding.\nWe'll generate wait times based on the historical temperature, park close time, and ticket season (the second two are technically specific to Disney, but we expect a strong correlation with the Universal versions).\nBecause this is a negative outcome, it is not related to whether or not there were Extra Magic Morning hours at Disney.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseven_dwarfs_sim <- seven_dwarfs_train_2018 |>\n  mutate(\n    # we scale each variable and add a bit of random noise\n    # to simulate reasonable Universal wait times\n    wait_time_universal =\n      park_temperature_high / 150 +\n        as.numeric(park_close) / 1500 +\n        as.integer(factor(park_ticket_season)) / 1000 +\n        rnorm(n(), 5, 5)\n  )\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nIf we calculate the IPW effect of `park_extra_magic_morning` on `wait_time_universal`, we get 0.21 minutes, a roughly null effect, as expected.\nBut what if we missed an unmeasured confounder, `u`, which caused Extra Magic Mornings and wait times at both Disney and Universal?\nLet's simulate that scenario but augment the data further.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseven_dwarfs_sim2 <- seven_dwarfs_train_2018 |>\n  mutate(\n    u = rnorm(n(), mean = 10, sd = 3),\n    wait_minutes_posted_avg = wait_minutes_posted_avg + u,\n    park_extra_magic_morning = ifelse(\n      u > 10,\n      rbinom(1, 1, .1),\n      park_extra_magic_morning\n    ),\n    wait_time_universal =\n      park_temperature_high / 150 +\n        as.numeric(park_close) / 1500 +\n        as.integer(factor(park_ticket_season)) / 1000 +\n        u +\n        rnorm(n(), 5, 5)\n  )\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nNow, the effect for both Disney and Universal wait times is different.\nIf we had seen 0.67 minutes for the effect for Disney, we wouldn't necessarily know that we had a confounded result.\nHowever, since we know the wait times at Universal should be unrelated, it's suspicious that the result, -2.32 minutes, is not null.\nThat is evidence that we have unmeasured confounding.\n\n### DAG-data consistency\n\nNegative controls use the logical implications of the causal structure you assume.\nWe can extend that idea to the entire DAG.\nIf the DAG is correct, there are many implications for statistically determining how different variables in the DAG should and should not be related to each other.\nLike negative controls, we can check if variables that *should* be independent *are* independent in the data.\nSometimes, the way that DAGs imply independence between variables is *conditional* on other variables.\nThus, this technique is sometimes called implied conditional independencies [@Textor2016]*.* Let's query our original DAG to find out what it says about the relationships among the variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquery_conditional_independence(emm_wait_dag) |>\n  unnest(conditioned_on)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  set   a                     b          conditioned_on\n  <chr> <chr>                 <chr>      <chr>         \n1 1     park_close            park_temp… <NA>          \n2 2     park_close            park_tick… <NA>          \n3 3     park_temperature_high park_tick… <NA>          \n```\n\n\n:::\n:::\n\n\nIn this DAG, three relationships should be null: 1) `park_close` and `park_temperature_high`, 2) `park_close` and `park_ticket_season`, and 3) `park_temperature_high` and `park_ticket_season`.\nNone of these relationships need to condition on another variable to achieve independence; in other words, they should be unconditionally independent.\nWe can use simple techniques like correlation and regression, as well as other statistical tests, to see if nullness holds for these relationships.\nConditional independencies quickly grow in number in complex DAGs, and so dagitty implements a way to automate checks for DAG-data consistency given these implied nulls.\ndagitty checks if the residuals of a given conditional relationship are correlated, which can be modeled automatically in several ways.\nWe'll tell dagitty to calculate the residuals using non-linear models with `type = \"cis.loess\"`.\nSince we're working with correlations, the results should be around 0 if our DAG is right.\nAs we see in @fig-conditional-ind, though, one relationship doesn't hold.\nThere is a correlation between the park's close time and ticket season.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_conditional_independence(\n  emm_wait_dag,\n  data = seven_dwarfs_train_2018 |>\n    filter(wait_hour == 9) |>\n    mutate(\n      across(where(is.character), factor),\n      park_close = as.numeric(park_close),\n    ) |>\n    as.data.frame(),\n  type = \"cis.loess\",\n  # use 200 bootstrapped samples to calculate CIs\n  R = 200\n) |>\n  ggdag_conditional_independence()\n```\n\n::: {.cell-output-display}\n![A plot of the estimates and 95% confidence intervals of the correlations between the residuals resulting from a regression of variables in the DAG that should have no relationship. While two relationships appear null, park close time and ticket season seem to be correlated, suggesting we have misspecified the DAG. One source of this misspecification may be missing arrows between the variables. Notably, the adjustment sets are identical with and without this arrow.](21-sensitivity_files/figure-html/fig-conditional-ind-1.png){#fig-conditional-ind width=672}\n:::\n:::\n\n\nWhy might we be seeing a relationship when there isn't supposed to be one?\nA simple explanation is chance: just like in any statistical inference, we need to be cautious about over-extrapolating what we see in our limited sample.\nSince we have data for every day in 2018, we could probably rule that out.\nAnother reason is that we're missing direct arrows from one variable to the other, e.g. from historic temperature to park close time.\nAdding additional arrows is reasonable: park close time and ticket season closely track the weather.\nThat's a little bit of evidence that we're missing an arrow.\n\nAt this point, we need to be cautious about overfitting the DAG to the data.\nDAG-data consistency tests *cannot* prove your DAG right and wrong, and as we saw in @sec-quartets, statistical techniques alone cannot determine the causal structure of a problem.\nSo why use these tests?\nAs with negative controls, they provide a way to probe your assumptions.\nWhile we can never be sure about them, we *do* have information in the data.\nFinding that conditional independence holds is a little more evidence supporting your assumptions.\nThere's a fine line here, so we recommend being transparent about these types of checks: if you make changes based on the results of these tests, you should report your original DAG, too.\nNotably, in this case, adding direct arrows to all three of these relationships results in an identical adjustment set.\n\nLet's look at an example that is more likely to be misspecified, where we remove the arrows from park close time and ticket season to Extra Magic Morning.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nemm_wait_dag2 <- dagify(\n  wait_minutes_posted_avg ~ park_extra_magic_morning + park_close +\n    park_ticket_season + park_temperature_high,\n  park_extra_magic_morning ~ park_temperature_high,\n  coords = coord_dag,\n  labels = labels,\n  exposure = \"park_extra_magic_morning\",\n  outcome = \"wait_minutes_posted_avg\"\n)\n\nquery_conditional_independence(emm_wait_dag2) |>\n  unnest(conditioned_on)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  set   a                        b       conditioned_on\n  <chr> <chr>                    <chr>   <chr>         \n1 1     park_close               park_e… <NA>          \n2 2     park_close               park_t… <NA>          \n3 3     park_close               park_t… <NA>          \n4 4     park_extra_magic_morning park_t… <NA>          \n5 5     park_temperature_high    park_t… <NA>          \n```\n\n\n:::\n:::\n\n\nThis alternative DAG introduces two new relationships that should be independent.\nIn @fig-conditional-ind-misspec, we see an additional association between ticket season and Extra Magic Morning.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_conditional_independence(\n  emm_wait_dag2,\n  data = seven_dwarfs_train_2018 |>\n    filter(wait_hour == 9) |>\n    mutate(\n      across(where(is.character), factor),\n      park_close = as.numeric(park_close),\n    ) |>\n    as.data.frame(),\n  type = \"cis.loess\",\n  R = 200\n) |>\n  ggdag_conditional_independence()\n```\n\n::: {.cell-output-display}\n![A plot of the estimates and 95% confidence intervals of the correlations between the residuals resulting from a regression of variables in the DAG that should have no relationship. While two relationships appear null, park close time and ticket season seem to be correlated, suggesting we have misspecified the DAG. One source of this misspecification may be missing arrows between the variables.](21-sensitivity_files/figure-html/fig-conditional-ind-misspec-1.png){#fig-conditional-ind-misspec width=672}\n:::\n:::\n\n\nSo, is this DAG wrong?\nBased on our understanding of the problem, it seems likely that's the case, but interpreting DAG-data consistency tests has a hiccup: different DAGs can have the same set of conditional independencies.\nIn the case of our DAG, one other DAG can generate the same implied conditional independencies (@fig-equiv-dag).\nThese are called *equivalent* DAGs because their implications are the same.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_equivalent_dags(emm_wait_dag2)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Equivalent DAGs for the likely misspecified version of @fig-dag-magic. These two DAGs produce the same set of implied conditional independencies. The difference between them is only the direction of the arrow between historic high temperature and Extra Magic Hours.](21-sensitivity_files/figure-html/fig-equiv-dag-1.png){#fig-equiv-dag width=864}\n:::\n:::\n\n\nEquivalent DAGs are generated by *reversing* arrows.\nThe subset of DAGs with reversible arrows that generate the same implications is called an *equivalence class*.\nWhile technical, this connection can condense the visualization to a single DAG where the reversible edges are denoted by a straight line without arrows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_equivalent_class(emm_wait_dag2, use_text = FALSE, use_labels = TRUE)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![An alternative way of visualizing @fig-equiv-dag where all the equivalent DAGs are condensed to a single version where the *reversible* edges are denoted with edges without arrows.](21-sensitivity_files/figure-html/fig-equiv-class-1.png){#fig-equiv-class width=480}\n:::\n:::\n\n\nSo, what do we do with this information?\nSince many DAGs can produce the same set of conditional independencies, one strategy is to find all the adjustment sets that would be valid for every equivalent DAG.\ndagitty makes this straightforward by calling `equivalenceClass()` and `adjustmentSets()`, but in this case, there are *no* overlapping adjustment sets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dagitty)\n# determine valid sets for all equiv. DAGs\nequivalenceClass(emm_wait_dag2) |>\n  adjustmentSets(type = \"all\")\n```\n:::\n\n\nWe can see that by looking at the individual equivalent DAGs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndags <- equivalentDAGs(emm_wait_dag2)\n\n# no overlapping sets\ndags[[1]] |> adjustmentSets(type = \"all\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{ park_temperature_high }\n{ park_close, park_temperature_high }\n{ park_temperature_high, park_ticket_season }\n{ park_close, park_temperature_high,\n  park_ticket_season }\n```\n\n\n:::\n\n```{.r .cell-code}\ndags[[2]] |> adjustmentSets(type = \"all\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n {}\n{ park_close }\n{ park_ticket_season }\n{ park_close, park_ticket_season }\n```\n\n\n:::\n:::\n\n\nThe good news is that, in this case, one of the equivalent DAGs doesn't make logical sense: the reversible edge is from historical weather to Extra Magic Morning, but that is impossible for both time-ordering reasons (historical temperature occurs in the past) and for logical ones (Disney may be powerful, but to our knowledge, they can't yet control the weather).\nEven though we're using more data in these types of checks, we need to consider the logical and time-ordered plausibility of possible scenarios.\n\n### Alternate DAGs\n\n<!-- TODO: I think this should be an extension of what we do in the machine learning chapter, e.g., we throw a more complex set of covariates at TMLE, and then we revisit that analysis here. In other words, this alt dag should have a little bit of a thread through the book. -->\n\nAs we mentioned in @sec-dags-iterate, you should specify your DAG ahead of time with ample feedback from other experts.\nLet's now take the opposite approach to the last example: what if we used the original DAG but received feedback after the analysis that we should add more variables?\nConsider the expanded DAG in @fig-dag-extra-days.\nWe've added two new confounders: whether it's a weekend or a holiday.\nThis analysis differs from when we checked alternate adjustment sets in the same DAG; in that case, we checked the DAG's logical consistency.\nIn this case, we're considering a different causal structure.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![An expansion of @fig-dag-magic, which now includes two new variables on their own backdoor paths: whether or not it's a holiday and/or a weekend.\n](21-sensitivity_files/figure-html/fig-dag-extra-days-1.png){#fig-dag-extra-days width=672}\n:::\n:::\n\n\nWe can calculate these features from `park_date` using the timeDate package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(timeDate)\n\nholidays <- c(\n  \"USChristmasDay\",\n  \"USColumbusDay\",\n  \"USIndependenceDay\",\n  \"USLaborDay\",\n  \"USLincolnsBirthday\",\n  \"USMemorialDay\",\n  \"USMLKingsBirthday\",\n  \"USNewYearsDay\",\n  \"USPresidentsDay\",\n  \"USThanksgivingDay\",\n  \"USVeteransDay\",\n  \"USWashingtonsBirthday\"\n) |>\n  holiday(2018, Holiday = _) |>\n  as.Date()\n\nseven_dwarfs_with_days <- seven_dwarfs_train_2018 |>\n  mutate(\n    is_holiday = park_date %in% holidays,\n    is_weekend = isWeekend(park_date)\n  ) |>\n  filter(wait_hour == 9)\n```\n:::\n\n\nBoth Extra Magic Morning hours and posted wait times are associated with whether it's a holiday or weekend.\n\n\n::: {#tbl-days .cell tbl-cap='The descriptive associations between the two new variables, holiday and weekend, and the exposure and outcome. The average posted waiting time differs on both holidays and weekends, as do the occurrences of Extra Magic Hours. While we can\\'t determine a confounding relationship from descriptive statistics alone, this adds to the evidence that these are confounders.\n'}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"luuebdqigy\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#luuebdqigy table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#luuebdqigy thead, #luuebdqigy tbody, #luuebdqigy tfoot, #luuebdqigy tr, #luuebdqigy td, #luuebdqigy th {\n  border-style: none;\n}\n\n#luuebdqigy p {\n  margin: 0;\n  padding: 0;\n}\n\n#luuebdqigy .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#luuebdqigy .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#luuebdqigy .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#luuebdqigy .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#luuebdqigy .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#luuebdqigy .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#luuebdqigy .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#luuebdqigy .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#luuebdqigy .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#luuebdqigy .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#luuebdqigy .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#luuebdqigy .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#luuebdqigy .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#luuebdqigy .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#luuebdqigy .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#luuebdqigy .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#luuebdqigy .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#luuebdqigy .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#luuebdqigy .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#luuebdqigy .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#luuebdqigy .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#luuebdqigy .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#luuebdqigy .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#luuebdqigy .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#luuebdqigy .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#luuebdqigy .gt_left {\n  text-align: left;\n}\n\n#luuebdqigy .gt_center {\n  text-align: center;\n}\n\n#luuebdqigy .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#luuebdqigy .gt_font_normal {\n  font-weight: normal;\n}\n\n#luuebdqigy .gt_font_bold {\n  font-weight: bold;\n}\n\n#luuebdqigy .gt_font_italic {\n  font-style: italic;\n}\n\n#luuebdqigy .gt_super {\n  font-size: 65%;\n}\n\n#luuebdqigy .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#luuebdqigy .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#luuebdqigy .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#luuebdqigy .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#luuebdqigy .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#luuebdqigy .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#luuebdqigy .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Weekend\">\n        <span class=\"gt_column_spanner\">Weekend</span>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Holiday\">\n        <span class=\"gt_column_spanner\">Holiday</span>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;FALSE&lt;/strong&gt;, N = 253&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>FALSE</strong>, N = 253<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;TRUE&lt;/strong&gt;, N = 101&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>TRUE</strong>, N = 101<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;FALSE&lt;/strong&gt;, N = 343&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>FALSE</strong>, N = 343<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;TRUE&lt;/strong&gt;, N = 11&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>TRUE</strong>, N = 11<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Posted Wait Time</td>\n<td headers=\"stat_1_1\" class=\"gt_row gt_center\">67 (60, 77)</td>\n<td headers=\"stat_2_1\" class=\"gt_row gt_center\">65 (56, 75)</td>\n<td headers=\"stat_1_2\" class=\"gt_row gt_center\">66 (58, 77)</td>\n<td headers=\"stat_2_2\" class=\"gt_row gt_center\">76 (63, 77)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Extra Magic Morning</td>\n<td headers=\"stat_1_1\" class=\"gt_row gt_center\">55 (22%)</td>\n<td headers=\"stat_2_1\" class=\"gt_row gt_center\">5 (5.0%)</td>\n<td headers=\"stat_1_2\" class=\"gt_row gt_center\">59 (17%)</td>\n<td headers=\"stat_2_2\" class=\"gt_row gt_center\">1 (9.1%)</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"5\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> Median (IQR); n (%)</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nWhen we refit the IPW estimator, we get 7.58 minutes, slightly bigger than we got without the two new confounders.\nBecause it was a deviation from the analysis plan, you should likely report both effects.\nThat said, this new DAG is probably more correct than the original one.\nFrom a decision point of view, though, the difference is slight in absolute terms (about a minute) and the effect in the same direction as the original estimate.\nIn other words, the result is not terribly sensitive to this change regarding how we might act on the information.\n\nOne other point here: sometimes, people present the results of using increasingly complicated adjustment sets.\nThis comes from the tradition of comparing complex models to parsimonious ones.\nThat type of comparison is a sensitivity analysis in its own right, but it should be principled: rather than fitting simple models for simplicity's sake, you should compare *competing* adjustment sets or conditions.\nFor instance, you may feel like these two DAGs are equally plausible or want to examine if adding other variables better captures the baseline crowd flow at the Magic Kingdom.\n\n## Quantitative bias analyses\n\nThus far, we've probed some of the assumptions we've made about the causal structure of the question.\nWe can take this further using quantitative bias analysis, which uses mathematical assumptions to see how results would change under different conditions.\n\n### Tipping point analyses\n\n### Other types of QBA\n",
    "supporting": [
      "21-sensitivity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}